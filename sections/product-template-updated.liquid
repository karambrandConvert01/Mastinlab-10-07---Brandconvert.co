{% include 'product-template-updated',
  description_style: section.settings.description_style,
  image_position: section.settings.image_position,
  image_container_width: section.settings.image_size,
  section_id: product.id,
  social: section.settings.social_enable,
  thumbnail_position: section.settings.thumbnail_position,
  thumbnail_arrows: section.settings.thumbnail_arrows,
  video_looping: section.settings.enable_video_looping,
  video_style: section.settings.product_video_style
%}

{% if settings.enable_product_reviews and settings.reviews_layout == 'full' %}
  <hr id="Reviews-{{ product.id }}" class="hr--clear">
  <div class="index-section product-reviews product-reviews--full">
    <div class="page-width">
      <div id="shopify-product-reviews" data-id="{{product.id}}">{{ product.metafields.spr.reviews }}</div>
    </div>
  </div>
{% endif %}

{% schema %}
  {
    "name": "Product pages",
    "settings": [
      {
        "type": "select",
        "id": "description_style",
        "label": "Description position",
        "default": "default",
        "options": [
          {
            "value": "default",
            "label": "Next to media"
          },
          {
            "value": "full",
            "label": "Below media"
          }
        ]
      },
      {
        "type": "color",
        "id": "vcolor_loading",
        "label": "Add to cart loading ",
        "default": "rgba(0, 0, 0, 1)"
      },
      {
        "type": "header",
        "content": "Variant button"
      },
      {
        "type": "color",
        "id": "vcolor_btn_selected",
        "label": "Variant selected border color",
        "default": "rgba(0, 0, 0, 0)"
      },
      {
        "type": "color",
        "id": "vcolor_btn_selected_c",
        "label": "Variant selected color",
        "default": "rgba(0, 0, 0, 0)"
      },
      {
        "type": "color",
        "id": "vcolor_btn_bg",
        "label": "Variant background color",
        "default": "rgba(0, 0, 0, 0)"
      },
      {
        "type": "color",
        "id": "vcolor_btn_bg_hover",
        "label": "Variant background hover color",
        "default": "rgba(0, 0, 0, 0.1)"
      },
      {
        "type": "color",
        "id": "vcolor_btn_br",
        "label": "Variant border color",
        "default": "rgba(0, 0, 0, 0.8)"
      },
      {
        "type": "color",
        "id": "vcolor_btn_br_hover",
        "label": "Variant border hover color",
        "default": "rgba(0, 0, 0, 1)"
      },
      {
        "type": "color",
        "id": "vcolor_btn",
        "label": "Variant text color",
        "default": "rgba(0,0,0,0.8)"
      },
      {
        "type": "color",
        "id": "vcolor_btn_hover",
        "label": "Variant text hover color",
        "default": "rgba(0,0,0,1)"
      },
      {
        "type": "header",
        "content": "Add to cart button"
      },
      {
        "type": "color",
        "id": "color_btn_bg",
        "label": "Buttons background color",
        "default": "rgba(0, 0, 0, 0)"
      },
      {
        "type": "color",
        "id": "color_btn_bg_hover",
        "label": "Buttons background hover color",
        "default": "rgba(0, 0, 0, 0.1)"
      },
      {
        "type": "color",
        "id": "color_btn_br",
        "label": "Buttons border color",
        "default": "rgba(0, 0, 0, 0.8)"
      },
      {
        "type": "color",
        "id": "color_btn_br_hover",
        "label": "Buttons border hover color",
        "default": "rgba(0, 0, 0, 1)"
      },
      {
        "type": "color",
        "id": "color_btn",
        "label": "Buttons text color",
        "default": "rgba(0,0,0,0.8)"
      },
      {
        "type": "color",
        "id": "color_btn_hover",
        "label": "Buttons text hover color",
        "default": "rgba(0,0,0,1)"
      },
      {
        "type": "header",
        "content": "Add to cart (Mobile) button"
      },
      {
        "type": "color",
        "id": "color_mobile_btn",
        "label": "Buttons Mobile color",
        "default": "rgba(0,0,0,0.8)"
      },
      {
        "type": "color",
        "id": "bg_mobile_color_btn",
        "label": "Buttons Background Mobile",
        "default": "rgba(0,0,0,0)"
      },
      {
        "type": "color",
        "id": "mobile_border_color_btn",
        "label": "Buttons Mobile border color",
        "default": "rgba(0,0,0,0.8)"
      },
      {
        "type": "checkbox",
        "id": "social_enable",
        "label": "Enable social sharing",
        "default": true
      },
      {
        "type": "header",
        "content": "Media"
      },
      {
        "type": "paragraph",
        "content": "Learn more about [media types](https://help.shopify.com/en/manual/products/product-media)"
      },
      {
        "type": "select",
        "id": "image_position",
        "label": "Position",
        "default": "right",
        "options": [
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "right",
            "label": "Right"
          }
        ]
      },
      {
        "type": "select",
        "id": "image_size",
        "label": "Size",
        "default": "medium",
        "options": [
          {
            "value": "small",
            "label": "Small"
          },
          {
            "value": "medium",
            "label": "Medium"
          },
          {
            "value": "large",
            "label": "Large"
          }
        ]
      },
      {
        "type": "select",
        "id": "thumbnail_position",
        "label": "Thumbnail position",
        "default": "beside",
        "options": [
          {
            "value": "beside",
            "label": "Next to media"
          },
          {
            "value": "below",
            "label": "Below media"
          }
        ]
      },
      {
        "type": "checkbox",
        "id": "thumbnail_arrows",
        "label": "Show thumbnail arrows"
      },
      {
        "type": "checkbox",
        "id": "enable_video_looping",
        "label": "Enable video looping",
        "default": true
      },
      {
        "type": "select",
        "id": "product_video_style",
        "label": "Video style",
        "default": "muted",
        "options": [
          {
            "value": "muted",
            "label": "Video without sound"
          },
          {
            "value": "unmuted",
            "label": "Video with sound"
          }
        ],
        "info": "Video with sound will not autoplay"
      },
      {
        "type": "header",
        "content": "Featured Style"
      },
      {
        "type": "range",
        "id": "padding-top",
        "label": "Padding Top",
        "unit": "px",
        "min": 0,
        "max": 100,
        "step": 5,
        "default": 0
      },
      {
        "type": "range",
        "id": "padding-bottom",
        "label": "Padding Bottom",
        "unit": "px",
        "min": 0,
        "max": 100,
        "step": 5,
        "default": 75
      }
    ],
    "blocks": [
      {
        "name": "Featured in",
        "type": "featuredIn",
        "settings": [
          {
            "type": "image_picker",
            "id": "img",
            "label": "Image"
          },
          {
            "type": "url",
            "id": "link",
            "label": "Link"
          }
        ]
      }
    ]
  }
{% endschema %}

{% style %}
  #shopify-section-{{ section.id }} .page-content--product .add-to-cart {
    background-color: {{ section.settings.color_btn_bg }} !important;
    border: 1px solid {{ section.settings.color_btn_br }} !important;
    color: {{ section.settings.color_btn }} !important;
  }
  @media screen and (max-width:640px) {
    body:not(.template-product) .page-content--product .add-to-cart,
    li.dp_for_mobile #scroll-to-cart {
      background-color: {{ section.settings.bg_mobile_color_btn }} !important;
      border: 1px solid {{ section.settings.mobile_border_color_btn }} !important;
      color: {{ section.settings.color_mobile_btn }} !important;
    }
  }
  #shopify-section-{{ section.id }} .page-content--product .add-to-cart:hover {
    background-color: {{ section.settings.color_btn_bg_hover }} !important;
    border: 1px solid{{ section.settings.color_btn_br_hover }} !important;
    color: {{ section.settings.color_btn_hover }} !important;
  }
  #shopify-section-{{ section.id }} .btn--loading:before {
    border-color: {{ section.settings.vcolor_loading }} !important;
  }
  #shopify-section-{{ section.id }} .page-content--product .variant__button-label {
    background-color:{{ section.settings.vcolor_btn_bg }} !important;
    border:1px solid {{ section.settings.vcolor_btn_br }} !important;
    color: {{ section.settings.vcolor_btn }} !important;
  }
  #shopify-section-{{ section.id }} .page-content--product .variant__button-label:hover {
    background-color: {{ section.settings.vcolor_btn_bg_hover }} !important;
    border: 1px solid {{ section.settings.vcolor_btn_br_hover }} !important;
    color: {{ section.settings.vcolor_btn_hover }} !important;
  }
  #shopify-section-{{ section.id }} .page-content--product .variant-input-wrap input[type='radio']:checked+label{
    border-color: {{ section.settings.vcolor_btn_selected }} !important;
    color: {{ section.settings.vcolor_btn_selected_c }} !important;
  }
  #shopify-section-{{ section.id }} .h2.product-single__title {
    line-height: 1.25;
  }
  {% if product.metafields.rel.product_requirements != blank %}
  #shopify-section-{{ section.id }} .product-single__description .collapsible-trigger {
    display: none;
  }
  {% endif %}
  #shopify-section-{{ section.id }} .bulletPointsContainer ul {
    font-size: 1.1rem;
    line-height: 1.3;
    list-style: none;
    margin: 0;
  }
  #shopify-section-{{ section.id }} .bulletPointsContainer li {
    padding-left: 1.5em;
    position: relative;
  }
  #shopify-section-{{ section.id }} .bulletPointsContainer li + li {
    margin-top: 0.75em;
  }
  #shopify-section-{{ section.id }} .bulletPointsContainer li::before {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 312.2 336.6'%3E%3Cg%3E%3Cpath class='st0' d='M105.9,231.9c48-89,122-157,192-229c7-8,18,2,13,10c-60,96-121,192-167,296c-1,2-2,4-5,5l-62,22c-4,2-9-1-10-5 c-18-50-35-91-65-135c-3-3-2-8,0-11C55.9,126.9,88.9,181.9,105.9,231.9z'/%3E%3C/g%3E%3C/svg%3E");
    background-position: center;
    background-repeat: no-repeat;
    background-size: contain;
    content: "";
    height: 1em;
    left: 0;
    position: absolute;
    top: 0.1em;
    width: 1em;
  }
  #shopify-section-{{ section.id }} .featuredInContainer {
    padding-bottom: {{ section.settings.padding-bottom }}px;
    padding-top: {{ section.settings.padding-top }}px;
  }
  #shopify-section-{{ section.id }} .featuredInWrapper,
  #shopify-section-{{ section.id }} .featuredInInner {
    align-items: center;
    display: flex;
    flex-wrap: wrap;
    gap: 3.375rem;
    justify-content: center;
  }
  #shopify-section-{{ section.id }} .slick-initialized .slick-slide {
    display: none;
  }
  #shopify-section-{{ section.id }} .slick-initialized .slick-slide.slick-active {
    display: block;
    left: 0 !important;
  }
  #shopify-section-{{ section.id }} .featuredInItem img {
    max-height: 50px;
  }
  {% comment %} description accordian {% endcomment %}
  #shopify-section-{{ section.id }} .product-single__description_exert ~ .product-single__description,
  #shopify-section-{{ section.id }} .product-single__description_accordion p:empty {
    display: none;
  }
  #shopify-section-{{ section.id }} .product-single__description_exert ~ .product-single__description {
    margin-top: 15px;
  }
  #shopify-section-{{ section.id }} .product-single__description_accordion .product-single__description_accordion-btn button {
    align-items: center;
    color: #474747;
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    padding: 0;
  }
  #shopify-section-{{ section.id }} .product-single__description_accordion .product-single__description_accordion-btn button::after {
    content: "Read More";
  }
  #shopify-section-{{ section.id }} .product-single__description_accordion .product-single__description_accordion-btn button .collapsible-trigger__icon--circle {
    position: static;
    transform: translateY(0%);
  }
  #shopify-section-{{ section.id }} .product-single__description_accordion.open .product-single__description_accordion-btn button .collapsible-trigger__icon--circle {
    transform: translate(0) scaleY(-1);
  }
  #shopify-section-{{ section.id }} .product-single__description_accordion.open .product-single__description_accordion-btn button::after {
    content: "Read Less";
  }
  {% comment %} description accordian {% endcomment %}
  #shopify-section-{{ section.id }} .product_requirementsContainer {
    text-align: left;
  }
  @media only screen and (max-width: 767px) {
    #shopify-section-{{ section.id }} .featuredInWrapper,
    #shopify-section-{{ section.id }} .featuredInInner {
      gap: 1rem;
      width: 100%;
    }
    #shopify-section-{{ section.id }} .featuredInItem {
      text-align: center;
      width: 100%;
    }
    #shopify-section-{{ section.id }} .featuredInItem img {
      margin: 0 auto;
    }
    #shopify-section-{{ section.id }} .bulletPointsContainer ul {
      font-size: 1rem;
    }
    #shopify-section-{{ section.id }} .product__thumbs {
      display: flex;
      overflow: auto;
    }

    #shopify-section-{{ section.id }} .product__thumbs--beside {
      display: flex;
      flex: 1 1 100%;
      margin: 0;
      max-width: 100%;
      overflow: auto;
    }
    #shopify-section-{{ section.id }} .product__photos--main {
      width: 100%;
    }
    #shopify-section-{{ section.id }} .product__photos--beside {
      flex-wrap: wrap;
    }
    #shopify-section-{{ section.id }} .product__thumb-item {
      width: 80px;
    }
  }
{% endstyle %}

<!--Start Klaviyo Product Retarget-->
<script type="text/javascript">
  var _learnq = _learnq || [];
  var item = {
    Name: {{ product.title|json }},
    ProductID: {{ product.id|json }},
    Categories: {{ product.collections|map:'title'|json }},
    ImageURL: "https:{{ product.featured_image.src|img_url:'grande' }}",
    URL: "{{ shop.secure_url }}{{ product.url }}",
    Brand: {{ product.vendor|json }},
    Price: {{ product.price|money|json }},
    CompareAtPrice: {{ product.compare_at_price_max|money|json }}
  };
  _learnq.push(['track', 'Viewed Product', item]);
  _learnq.push(['trackViewedItem', {
    Title: item.Name,
    ItemId: item.ProductID,
    Categories: item.Categories,
    ImageUrl: item.ImageURL,
    Url: item.URL,
    Metadata: {
      Brand: item.Brand,
      Price: item.Price,
      CompareAtPrice: item.CompareAtPrice
    }
  }]);
</script>
<!--End Klaviyo Product Retarget-->

<script>
  // Override default values of shop.strings for each template.
  // Alternate product templates can change values of
  // add to cart button, sold out, and unavailable states here.
  theme.productStrings = {
    addToCart: {{ 'products.product.add_to_cart' | t | json }},
    soldOut: {{ 'products.product.sold_out' | t | json }},
    unavailable: {{ 'products.product.unavailable' | t | json }}
  };
</script>

<script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery('#shopify-section-{{ section.id }} .product-single__description_accordion .product-single__description_accordion-btn button').on('click', function() {
      const parentDiv = jQuery(this).parents('.product-single__description_accordion');
      if(parentDiv.hasClass('open')) {
        parentDiv.removeClass('open')
        parentDiv.find('.product-single__description').slideUp('slow')
      } else {
        parentDiv.addClass('open')
        parentDiv.find('.product-single__description').slideDown('slow')
      };
    });
    let featuredInInner = jQuery('#shopify-section-{{ section.id }} .featuredInInner');
    let featuredInInnerSettings = {
      autoplay: true,
      autoplaySpeed: 3000,
      dots: false,
      fade: true,
      infinite: true,
      slidesToShow: 1,
      slidesToScroll: 1,
      speed: 1000,
    }
    slick_on_mobile(featuredInInner, featuredInInnerSettings, 767);

    // slick on mobile
    function slick_on_mobile(slider, settings, breakPoint) {
      $(window).on('load resize', function() {
        if ($(window).width() > breakPoint) {
          if (slider.hasClass('slick-initialized')) {
            slider.slick('unslick');
          }
          return
        }
        if (!slider.hasClass('slick-initialized')) {
          return slider.slick(settings);
        }
      });
    };
  })
</script>